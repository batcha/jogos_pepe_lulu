<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üåæ Fazendinha da Lulu</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Press Start 2P', cursive;
            background: linear-gradient(to bottom, #87CEEB 0%, #98FB98 50%, #32CD32 70%, #228B22 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            position: relative;
        }
        
        /* Fundo da fazenda */
        body::before {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 40%;
            background: 
                /* Cerca */
                repeating-linear-gradient(
                    90deg,
                    transparent 0px,
                    transparent 18px,
                    #8B4513 18px,
                    #8B4513 22px
                ),
                /* Gramado */
                linear-gradient(to bottom, #32CD32 0%, #228B22 100%);
            z-index: 1;
        }
        
        /* Montanhas distantes */
        body::after {
            content: '';
            position: absolute;
            bottom: 25%;
            left: 0;
            width: 100%;
            height: 25%;
            background: 
                radial-gradient(ellipse 200px 100px at 20% bottom, #9370DB 0%, transparent 70%),
                radial-gradient(ellipse 300px 120px at 60% bottom, #8B008B 0%, transparent 70%),
                radial-gradient(ellipse 250px 80px at 85% bottom, #9932CC 0%, transparent 70%);
            opacity: 0.6;
            z-index: 2;
        }
        
        /* Anima√ß√µes de fundo */
        .cloud {
            position: absolute;
            background: #fff;
            border-radius: 50px;
            opacity: 0.9;
            animation: float 25s infinite linear;
            z-index: 3;
        }
        
        .cloud::before,
        .cloud::after {
            content: '';
            position: absolute;
            background: #fff;
            border-radius: 50px;
        }
        
        .cloud1 {
            width: 120px;
            height: 60px;
            top: 15%;
            left: -150px;
        }
        
        .cloud1::before {
            width: 80px;
            height: 80px;
            top: -40px;
            left: 20px;
        }
        
        .cloud1::after {
            width: 90px;
            height: 60px;
            top: -30px;
            right: 15px;
        }
        
        .cloud2 {
            width: 100px;
            height: 50px;
            top: 8%;
            left: -200px;
            animation-delay: -12s;
        }
        
        .cloud2::before {
            width: 60px;
            height: 60px;
            top: -30px;
            left: 15px;
        }
        
        .cloud2::after {
            width: 70px;
            height: 50px;
            top: -20px;
            right: 12px;
        }
        
        .cloud3 {
            width: 80px;
            height: 40px;
            top: 22%;
            left: -120px;
            animation-delay: -20s;
        }
        
        .cloud3::before {
            width: 50px;
            height: 50px;
            top: -25px;
            left: 12px;
        }
        
        .cloud3::after {
            width: 55px;
            height: 40px;
            top: -15px;
            right: 10px;
        }
        
        @keyframes float {
            0% { transform: translateX(-200px); }
            100% { transform: translateX(calc(100vw + 200px)); }
        }
        
        .animal {
            position: absolute;
            font-size: 48px;
            animation: walk 20s infinite linear;
            z-index: 4;
            filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.3));
        }
        
        .animal1 {
            bottom: 28%;
            left: -80px;
            animation-delay: 0s;
        }
        
        .animal2 {
            bottom: 35%;
            left: -80px;
            animation-delay: -10s;
        }
        
        .animal3 {
            bottom: 22%;
            left: -80px;
            animation-delay: -15s;
        }
        
        @keyframes walk {
            0% { transform: translateX(-80px); }
            100% { transform: translateX(calc(100vw + 80px)); }
        }
        
        /* Placa da fazenda */
        .farm-sign {
            position: absolute;
            right: 5%;
            bottom: 45%;
            font-size: 12px;
            background: #8B4513;
            color: #fff;
            padding: 8px 12px;
            border-radius: 8px;
            border: 3px solid #654321;
            text-align: center;
            z-index: 5;
            transform: rotate(-3deg);
            box-shadow: 3px 3px 8px rgba(0,0,0,0.4);
            text-shadow: 1px 1px 0px #000;
        }
        
        .farm-sign::before {
            content: '';
            position: absolute;
            bottom: -15px;
            left: 50%;
            transform: translateX(-50%);
            width: 6px;
            height: 15px;
            background: #654321;
            border-radius: 0 0 3px 3px;
        }
        
        /* Cerca detalhada */
        .fence {
            position: absolute;
            bottom: 15%;
            left: 0;
            width: 100%;
            height: 25px;
            z-index: 3;
        }
        
        .fence::before {
            content: '';
            position: absolute;
            width: 100%;
            height: 8px;
            background: #8B4513;
            top: 8px;
            box-shadow: 
                0 -12px 0 #8B4513,
                0 12px 0 #654321;
        }
        
        /* Postes da cerca */
        .fence::after {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            background: 
                repeating-linear-gradient(
                    90deg,
                    transparent 0px,
                    transparent 48px,
                    #654321 48px,
                    #654321 52px
                );
        }
        
        .flower {
            position: absolute;
            font-size: 28px;
            animation: sway 4s infinite ease-in-out;
            z-index: 4;
            filter: drop-shadow(1px 1px 2px rgba(0,0,0,0.2));
        }
        
        .flower1 { bottom: 18%; left: 8%; animation-delay: 0s; }
        .flower2 { bottom: 15%; right: 12%; animation-delay: 1.5s; }
        .flower3 { bottom: 20%; left: 75%; animation-delay: 3s; }
        .flower4 { bottom: 16%; left: 25%; animation-delay: 0.8s; }
        .flower5 { bottom: 22%; right: 35%; animation-delay: 2.2s; }
        
        @keyframes sway {
            0%, 100% { transform: rotate(-5deg); }
            50% { transform: rotate(5deg); }
        }
        
        .game-container {
            background: rgba(255, 255, 255, 0.98);
            border: 4px solid #4a4a4a;
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(15px);
            z-index: 15;
            position: relative;
        }
        
        h1 {
            color: #2d5a27;
            margin-bottom: 20px;
            font-size: 24px;
            text-shadow: 2px 2px 0px #fff;
        }
        
        .score {
            font-size: 16px;
            color: #d2691e;
            margin-bottom: 20px;
            text-shadow: 1px 1px 0px #fff;
        }
        
        .round-info {
            font-size: 12px;
            color: #8B4513;
            margin-bottom: 15px;
            text-shadow: 1px 1px 0px #fff;
        }
        
        .progress-bar {
            width: 100%;
            height: 20px;
            background: #ddd;
            border-radius: 10px;
            margin: 10px 0;
            overflow: hidden;
            border: 2px solid #8B4513;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(45deg, #32CD32, #228B22);
            width: 0%;
            transition: width 0.5s ease;
            border-radius: 8px;
        }
        
        .celebration {
            position: fixed;
            top: 30%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(45deg, #FFD700, #FFA500, #FF6347);
            color: #fff;
            padding: 25px 35px;
            border-radius: 20px;
            font-size: 16px;
            text-align: center;
            border: 4px solid #fff;
            box-shadow: 0 0 40px rgba(255, 215, 0, 0.8);
            z-index: 200;
            opacity: 0;
            animation: celebrate 2.5s ease-out;
            text-shadow: 2px 2px 0px #000;
        }
        
        .grid {
            display: grid;
            grid-template-columns: repeat(3, 80px);
            grid-template-rows: repeat(3, 80px);
            gap: 8px;
            margin: 20px auto;
            justify-content: center;
        }
        
        .cell {
            width: 80px;
            height: 80px;
            background: #8B4513;
            border: 3px solid #654321;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            transition: all 0.3s ease;
            image-rendering: pixelated;
            position: relative;
        }
        
        .cell::before {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            right: 2px;
            bottom: 2px;
            background: linear-gradient(45deg, #A0522D 0%, #8B4513 100%);
            border-radius: 4px;
            z-index: 1;
        }
        
        .cell span {
            position: relative;
            z-index: 2;
        }
        
        .cell:hover {
            transform: scale(1.1);
            border-color: #FFD700;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.6);
        }
        
        .cell.revealed {
            animation: reveal 0.5s ease-out;
        }
        
        .cell.carrot {
            background: linear-gradient(45deg, #FF8C00 0%, #FFA500 100%);
            border-color: #FF6347;
        }
        
        .cell.carrot::before {
            background: linear-gradient(45deg, #FFA500 0%, #FF8C00 100%);
        }
        
        .cell.grass {
            background: linear-gradient(45deg, #228B22 0%, #32CD32 100%);
            border-color: #006400;
        }
        
        .cell.grass::before {
            background: linear-gradient(45deg, #32CD32 0%, #228B22 100%);
        }
        
        @keyframes reveal {
            0% { transform: scale(1) rotateY(0deg); }
            50% { transform: scale(1.2) rotateY(90deg); }
            100% { transform: scale(1) rotateY(180deg); }
        }
        
        .game-over {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 100;
            align-items: center;
            justify-content: center;
        }
        
        .game-over-content {
            background: linear-gradient(45deg, #FF6B6B, #4ECDC4);
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            border: 4px solid #fff;
            box-shadow: 0 0 40px rgba(0, 0, 0, 0.5);
        }
        
        .game-over h2 {
            color: #fff;
            margin-bottom: 20px;
            font-size: 20px;
            text-shadow: 2px 2px 0px #000;
        }
        
        .final-score {
            font-size: 32px;
            color: #FFD700;
            margin: 20px 0;
            text-shadow: 2px 2px 0px #000;
        }
        
        .play-again {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 14px;
            font-family: 'Press Start 2P', cursive;
            border-radius: 10px;
            cursor: pointer;
            margin-top: 20px;
            transition: all 0.3s ease;
            border: 3px solid #fff;
        }
        
        .play-again:hover {
            transform: scale(1.1);
            box-shadow: 0 0 20px rgba(76, 175, 80, 0.6);
        }
        
        .instructions {
            font-size: 10px;
            color: #666;
            margin-top: 20px;
            line-height: 16px;
        }
        
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }
        
        .bounce {
            animation: bounce 0.6s ease-out;
        }
        
        /* Feedback visual do c√≥digo Konami */
        .konami-message {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(45deg, #FF6B35, #F7931E, #FFD23F);
            color: #fff;
            padding: 20px 30px;
            border-radius: 15px;
            font-size: 14px;
            text-align: center;
            border: 3px solid #fff;
            box-shadow: 0 0 30px rgba(255, 107, 53, 0.8);
            z-index: 200;
            opacity: 0;
            animation: konamiReveal 3s ease-out;
            text-shadow: 2px 2px 0px #000;
        }
        
        @keyframes konamiReveal {
            0% { 
                opacity: 0; 
                transform: translate(-50%, -50%) scale(0.5) rotate(-180deg);
            }
            20% { 
                opacity: 1; 
                transform: translate(-50%, -50%) scale(1.2) rotate(0deg);
            }
            80% { 
                opacity: 1; 
                transform: translate(-50%, -50%) scale(1) rotate(0deg);
            }
            100% { 
                opacity: 0; 
                transform: translate(-50%, -50%) scale(0.8) rotate(0deg);
            }
        }
        
        .konami-sparkles {
            position: fixed;
            pointer-events: none;
            z-index: 150;
        }
        
        .sparkle {
            position: absolute;
            font-size: 20px;
            animation: sparkleEffect 2s ease-out forwards;
        }
        
        @keyframes sparkleEffect {
            0% { 
                opacity: 1; 
                transform: scale(0) rotate(0deg);
            }
            50% { 
                opacity: 1; 
                transform: scale(1.5) rotate(180deg);
            }
            100% { 
                opacity: 0; 
                transform: scale(0.5) rotate(360deg);
            }
        }
        
        .screen-flash {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 215, 0, 0.3);
            z-index: 120;
            opacity: 0;
            animation: flash 0.5s ease-out;
        }
        
        @keyframes flash {
            0% { opacity: 0; }
            50% { opacity: 1; }
            100% { opacity: 0; }
        }
        
        @keyframes celebrate {
            0% { 
                opacity: 0; 
                transform: translate(-50%, -50%) scale(0.3) rotate(-45deg);
            }
            30% { 
                opacity: 1; 
                transform: translate(-50%, -50%) scale(1.1) rotate(0deg);
            }
            70% { 
                opacity: 1; 
                transform: translate(-50%, -50%) scale(1) rotate(0deg);
            }
            100% { 
                opacity: 0; 
                transform: translate(-50%, -50%) scale(0.8) rotate(0deg);
            }
        }
        
        .multiplier {
            display: inline-block;
            background: linear-gradient(45deg, #FF6B35, #F7931E);
            color: #fff;
            padding: 4px 8px;
            border-radius: 8px;
            font-size: 10px;
            margin-left: 10px;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        /* Power-ups */
        .powerups-container {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 15px 0;
            flex-wrap: wrap;
        }
        
        .powerup {
            background: linear-gradient(45deg, #6A5ACD, #9370DB);
            border: 3px solid #4B0082;
            border-radius: 12px;
            padding: 8px 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 10px;
            color: #fff;
            text-align: center;
            position: relative;
            min-width: 70px;
            text-shadow: 1px 1px 0px #000;
        }
        
        .powerup:hover:not(.disabled) {
            transform: scale(1.1);
            box-shadow: 0 0 20px rgba(106, 90, 205, 0.6);
        }
        
        .powerup.disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background: linear-gradient(45deg, #666, #888);
            border-color: #555;
        }
        
        .powerup .count {
            position: absolute;
            top: -8px;
            right: -8px;
            background: #FF6347;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 8px;
            border: 2px solid #fff;
        }
        
        .powerup.active {
            background: linear-gradient(45deg, #32CD32, #228B22);
            border-color: #006400;
            animation: powerupActive 2s infinite;
        }
        
        @keyframes powerupActive {
            0%, 100% { box-shadow: 0 0 10px rgba(50, 205, 50, 0.5); }
            50% { box-shadow: 0 0 25px rgba(50, 205, 50, 0.9); }
        }
        
        .cell.revealed-safe {
            background: linear-gradient(45deg, #87CEEB, #98FB98) !important;
            border-color: #4169E1 !important;
        }
        
        .cell.revealed-safe::before {
            background: linear-gradient(45deg, #98FB98, #87CEEB) !important;
        }
        
        .powerup-notification {
            position: fixed;
            top: 20%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(45deg, #9370DB, #6A5ACD);
            color: #fff;
            padding: 15px 25px;
            border-radius: 15px;
            font-size: 12px;
            text-align: center;
            border: 3px solid #fff;
            box-shadow: 0 0 25px rgba(147, 112, 219, 0.8);
            z-index: 200;
            opacity: 0;
            animation: powerupNotif 2s ease-out;
            text-shadow: 1px 1px 0px #000;
        }
        
        @keyframes powerupNotif {
            0% { opacity: 0; transform: translate(-50%, -50%) scale(0.5); }
            30% { opacity: 1; transform: translate(-50%, -50%) scale(1.1); }
            70% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
            100% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
        }
    </style>
</head>
<body>
    <!-- Elementos de fundo -->
    <div class="cloud cloud1"></div>
    <div class="cloud cloud2"></div>
    <div class="cloud cloud3"></div>
    
    <!-- Cerca -->
    <div class="fence"></div>
    
    <!-- Placa da fazenda -->
    <div class="farm-sign">
        üåæ FAZENDA<br>
        DA LULU üåæ
    </div>
    
    <!-- Animais -->
    <div class="animal animal1">üêÑ</div>
    <div class="animal animal2">üê∑</div>
    <div class="animal animal3">üêî</div>
    
    <!-- Flores -->
    <div class="flower flower1">üåª</div>
    <div class="flower flower2">üå∏</div>
    <div class="flower flower3">üå∫</div>
    <div class="flower flower4">üåº</div>
    <div class="flower flower5">üå∑</div>
    
    <!-- Container do jogo -->
    <div class="game-container">
        <h1>üåæ Fazendinha da Lulu üåæ</h1>
        <div class="score">
            Rodada: <span id="round">1</span> | 
            Cenouras: <span id="score">0</span> ü•ï
            <span id="multiplier" class="multiplier" style="display: none;">x2</span>
        </div>
        <div class="round-info">
            Encontre todas as <span id="carrotsToFind">8</span> cenouras para avan√ßar!
        </div>
        <div class="progress-bar">
            <div class="progress-fill" id="progressBar"></div>
        </div>
        
        <!-- Power-ups -->
        <div class="powerups-container">
            <div class="powerup" id="magnifier" onclick="usePowerup('magnifier')">
                üîç<br>
                <small>Lupa</small>
                <div class="count" id="magnifierCount">3</div>
            </div>
            <div class="powerup" id="clover" onclick="usePowerup('clover')">
                üçÄ<br>
                <small>Trevo</small>
                <div class="count" id="cloverCount">2</div>
            </div>
            <div class="powerup" id="golden" onclick="usePowerup('golden')">
                üíé<br>
                <small>B√¥nus</small>
                <div class="count" id="goldenCount">1</div>
            </div>
        </div>
        
        <div class="grid" id="grid">
            <div class="cell" data-index="0"><span></span></div>
            <div class="cell" data-index="1"><span></span></div>
            <div class="cell" data-index="2"><span></span></div>
            <div class="cell" data-index="3"><span></span></div>
            <div class="cell" data-index="4"><span></span></div>
            <div class="cell" data-index="5"><span></span></div>
            <div class="cell" data-index="6"><span></span></div>
            <div class="cell" data-index="7"><span></span></div>
            <div class="cell" data-index="8"><span></span></div>
        </div>
        
        <div class="instructions">
            üéØ Encontre todas as cenouras da rodada!<br>
            ‚ö†Ô∏è Evite pisar na grama ou perder√° todas as cenouras da rodada atual!<br>
            ‚ú® Use power-ups para te ajudar: üîç revela √°rea segura | üçÄ protege de grama | üíé dobra pontos
        </div>
    </div>
    
    <!-- Tela de Game Over -->
    <div class="game-over" id="gameOver">
        <div class="game-over-content">
            <h2>üéÆ Game Over! üéÆ</h2>
            <div class="final-score" id="finalScore">0</div>
            <p style="color: white; font-size: 12px; margin: 10px 0;">Cenouras coletadas!</p>
            <button class="play-again" onclick="restartGame()">üéØ Jogar Novamente</button>
        </div>
    </div>

    <script>
        let score = 0;
        let round = 1;
        let grassPositions = [];
        let carrotPositions = [];
        let foundCarrots = 0;
        let totalCarrots = 0;
        let gameActive = true;
        let streak = 0; // Para multiplicador
        
        // Sistema de Audio com MP3
        const audioEnabled = true;
        const audioVolume = 0.7;
        
        // Cache de √°udios pr√©-carregados
        const audioCache = {};
        
        function preloadAudio() {
            const audioFiles = {
                carrot: './sounds/carrot.mp3',
                grass: './sounds/grass.mp3',
                powerup: './sounds/powerup.mp3',
                celebration: './sounds/celebration.mp3',
                levelup: './sounds/levelup.mp3'
            };
            
            Object.keys(audioFiles).forEach(key => {
                audioCache[key] = new Audio(audioFiles[key]);
                audioCache[key].volume = audioVolume;
                audioCache[key].preload = 'auto';
                
                // Fallback caso o arquivo n√£o exista
                audioCache[key].addEventListener('error', () => {
                    console.log(`Arquivo de som n√£o encontrado: ${audioFiles[key]}`);
                    audioCache[key] = null;
                });
            });
        }
        
        // Fun√ß√£o para tocar √°udio
        function playSound(soundName) {
            if (!audioEnabled || !audioCache[soundName]) return;
            
            try {
                // Resetar o tempo do √°udio para permitir sobreposi√ß√£o
                audioCache[soundName].currentTime = 0;
                audioCache[soundName].play().catch(e => {
                    console.log('Erro ao tocar som:', e);
                });
            } catch (error) {
                console.log('Erro ao tocar som:', error);
            }
        }
        
        // Sons espec√≠ficos usando arquivos MP3
        function playCarrotSound() {
            playSound('carrot');
        }
        
        function playGrassSound() {
            playSound('grass');
        }
        
        function playPowerupSound() {
            playSound('powerup');
        }
        
        function playCelebrationSound() {
            playSound('celebration');
        }
        
        function playLevelUpSound() {
            playSound('levelup');
        }
        
        // Power-ups
        let powerups = {
            magnifier: 3,    // Lupa M√°gica - revela √°rea segura
            clover: 2,       // Trevo da Sorte - imunidade a grama
            golden: 1        // B√¥nus Dourado - dobra pontos da rodada
        };
        
        let activePowerups = {
            magnifier: false,
            clover: false,
            golden: false
        };
        
        function initGame() {
            // Reset do jogo
            score = 0;
            round = 1;
            streak = 0;
            gameActive = true;
            document.getElementById('score').textContent = score;
            document.getElementById('round').textContent = round;
            document.getElementById('gameOver').style.display = 'none';
            document.getElementById('multiplier').style.display = 'none';
            
            // Pr√©-carregar √°udios
            preloadAudio();
            
            // Reset power-ups
            powerups = { magnifier: 3, clover: 2, golden: 1 };
            activePowerups = { magnifier: false, clover: false, golden: false };
            updatePowerupUI();
            
            // Limpar grid
            const cells = document.querySelectorAll('.cell');
            cells.forEach(cell => {
                cell.classList.remove('revealed', 'carrot', 'grass', 'revealed-safe');
                cell.querySelector('span').textContent = '';
                cell.style.pointerEvents = 'auto';
            });
            
            // Nova rodada
            newRound();
        }
        
        function updatePowerupUI() {
            // Atualizar contadores
            document.getElementById('magnifierCount').textContent = powerups.magnifier;
            document.getElementById('cloverCount').textContent = powerups.clover;
            document.getElementById('goldenCount').textContent = powerups.golden;
            
            // Atualizar estados
            Object.keys(powerups).forEach(powerup => {
                const element = document.getElementById(powerup);
                if (powerups[powerup] <= 0) {
                    element.classList.add('disabled');
                } else {
                    element.classList.remove('disabled');
                }
                
                if (activePowerups[powerup]) {
                    element.classList.add('active');
                } else {
                    element.classList.remove('active');
                }
            });
        }
        
        function usePowerup(type) {
            if (powerups[type] <= 0 || !gameActive) return;
            
            // Som de power-up
            playPowerupSound();
            
            switch(type) {
                case 'magnifier':
                    useMagnifier();
                    break;
                case 'clover':
                    useClover();
                    break;
                case 'golden':
                    useGolden();
                    break;
            }
            
            powerups[type]--;
            updatePowerupUI();
        }
        
        function useMagnifier() {
            // Revela 2-3 quadrados seguros aleat√≥rios
            const safeCells = carrotPositions.filter(pos => {
                const cell = document.querySelector(`[data-index="${pos}"]`);
                return !cell.classList.contains('revealed');
            });
            
            const toReveal = safeCells.slice(0, Math.min(3, safeCells.length));
            
            toReveal.forEach(pos => {
                const cell = document.querySelector(`[data-index="${pos}"]`);
                cell.classList.add('revealed-safe');
            });
            
            showPowerupNotification('üîç LUPA ATIVADA!<br><small>√Åreas seguras reveladas!</small>');
        }
        
        function useClover() {
            activePowerups.clover = true;
            showPowerupNotification('üçÄ TREVO DA SORTE!<br><small>Pr√≥xima grama n√£o far√° efeito!</small>');
            updatePowerupUI();
        }
        
        function useGolden() {
            activePowerups.golden = true;
            showPowerupNotification('üíé B√îNUS DOURADO!<br><small>Pontos dobrados nesta rodada!</small>');
            updatePowerupUI();
        }
        
        function showPowerupNotification(message) {
            const notification = document.createElement('div');
            notification.className = 'powerup-notification';
            notification.innerHTML = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 2000);
        }
        
        function earnPowerup() {
            // Chance de ganhar power-up baseada na rodada
            if (Math.random() < 0.3) { // 30% de chance
                const types = ['magnifier', 'clover', 'golden'];
                const randomType = types[Math.floor(Math.random() * types.length)];
                
                powerups[randomType]++;
                updatePowerupUI();
                
                // Som de power-up ganho
                setTimeout(() => playPowerupSound(), 1000);
                
                const names = {
                    magnifier: 'üîç Lupa M√°gica',
                    clover: 'üçÄ Trevo da Sorte', 
                    golden: 'üíé B√¥nus Dourado'
                };
                
                showPowerupNotification(`üéÅ POWER-UP GANHO!<br><small>${names[randomType]} recebido!</small>`);
            }
        }
        
        function newRound() {
            if (!gameActive) return;
            
            foundCarrots = 0;
            
            // Reset power-ups ativos (exceto golden que dura a rodada toda)
            activePowerups.magnifier = false;
            if (!activePowerups.golden) {
                // Golden s√≥ reseta no final da rodada
            }
            
            // Aumentar dificuldade gradualmente
            let numGrass = Math.min(Math.floor(round / 2) + 1, 3); // 1-3 gramas
            totalCarrots = 9 - numGrass;
            
            // Sortear posi√ß√µes da grama
            grassPositions = [];
            while (grassPositions.length < numGrass) {
                const pos = Math.floor(Math.random() * 9);
                if (!grassPositions.includes(pos)) {
                    grassPositions.push(pos);
                }
            }
            
            // Definir posi√ß√µes das cenouras (resto dos quadrados)
            carrotPositions = [];
            for (let i = 0; i < 9; i++) {
                if (!grassPositions.includes(i)) {
                    carrotPositions.push(i);
                }
            }
            
            // Atualizar UI
            document.getElementById('carrotsToFind').textContent = totalCarrots;
            updateProgressBar();
            updatePowerupUI();
            
            // Limpar visualiza√ß√µes anteriores
            const cells = document.querySelectorAll('.cell');
            cells.forEach(cell => {
                cell.classList.remove('revealed', 'carrot', 'grass', 'revealed-safe');
                cell.querySelector('span').textContent = '';
                cell.style.pointerEvents = 'auto';
            });
        }
        
        function updateProgressBar() {
            const progress = (foundCarrots / totalCarrots) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
        }
        
        function revealCell(index) {
            if (!gameActive) return;
            
            const cell = document.querySelector(`[data-index="${index}"]`);
            const span = cell.querySelector('span');
            
            // Desabilitar clique
            cell.style.pointerEvents = 'none';
            
            // Anima√ß√£o de revela√ß√£o
            cell.classList.add('revealed');
            
            setTimeout(() => {
                if (grassPositions.includes(index)) {
                    // Verificar se tem trevo da sorte ativo
                    if (activePowerups.clover) {
                        // Trevo protege da grama
                        activePowerups.clover = false;
                        updatePowerupUI();
                        
                        // Transformar grama em cenoura temporariamente
                        cell.classList.add('carrot');
                        span.textContent = 'ü•ï';
                        foundCarrots++;
                        
                        // Som especial de salvamento
                        playCarrotSound();
                        setTimeout(() => playPowerupSound(), 200);
                        
                        showPowerupNotification('üçÄ TREVO SALVOU!<br><small>Grama virou cenoura!</small>');
                        
                        // Calcular pontos
                        let points = 1;
                        if (streak >= 5) points *= 2;
                        if (activePowerups.golden) points *= 2;
                        
                        score += points;
                        document.getElementById('score').textContent = score;
                        
                        updateProgressBar();
                        
                        if (foundCarrots >= totalCarrots) {
                            completeRound();
                        }
                    } else {
                        // Pisou na grama - Perde cenouras da rodada
                        cell.classList.add('grass');
                        span.textContent = 'üå±';
                        
                        // Som de erro
                        playGrassSound();
                        
                        streak = 0; // Reset streak
                        document.getElementById('multiplier').style.display = 'none';
                        
                        // Reset power-ups ativos
                        activePowerups.golden = false;
                        updatePowerupUI();
                        
                        loseRound();
                    }
                } else {
                    // Encontrou cenoura
                    cell.classList.add('carrot');
                    span.textContent = 'ü•ï';
                    foundCarrots++;
                    
                    // Som de cenoura encontrada
                    playCarrotSound();
                    
                    // Calcular pontos com multiplicadores
                    let points = 1;
                    if (streak >= 5) points *= 2; // Multiplicador de streak
                    if (activePowerups.golden) points *= 2; // Multiplicador golden
                    
                    score += points;
                    document.getElementById('score').textContent = score;
                    
                    // Mostrar multiplicador de streak
                    if (streak >= 5) {
                        document.getElementById('multiplier').style.display = 'inline-block';
                    }
                    
                    // Anima√ß√£o de pontua√ß√£o
                    document.getElementById('score').classList.add('bounce');
                    setTimeout(() => {
                        document.getElementById('score').classList.remove('bounce');
                    }, 600);
                    
                    updateProgressBar();
                    
                    // Verificar se completou a rodada
                    if (foundCarrots >= totalCarrots) {
                        completeRound();
                    }
                }
            }, 250);
        }
        
        function completeRound() {
            gameActive = false;
            streak++; // Aumenta streak por completar rodada
            
            // Som de celebra√ß√£o
            playCelebrationSound();
            
            // Som especial para n√≠veis m√∫ltiplos de 5
            if (round % 5 === 0) {
                setTimeout(() => playLevelUpSound(), 500);
            }
            
            // Reset golden power-up ap√≥s rodada completa
            activePowerups.golden = false;
            updatePowerupUI();
            
            // Chance de ganhar power-up
            earnPowerup();
            
            // Mostrar celebra√ß√£o
            showCelebration();
            
            // Pr√≥xima rodada ap√≥s celebra√ß√£o
            setTimeout(() => {
                round++;
                document.getElementById('round').textContent = round;
                gameActive = true;
                newRound();
            }, 3000);
        }
        
        function loseRound() {
            gameActive = false;
            
            // Reset todos os power-ups ativos
            activePowerups = { magnifier: false, clover: false, golden: false };
            updatePowerupUI();
            
            // Revelar todas as posi√ß√µes
            const cells = document.querySelectorAll('.cell');
            cells.forEach((cell, index) => {
                const span = cell.querySelector('span');
                cell.style.pointerEvents = 'none';
                
                if (grassPositions.includes(index) && !cell.classList.contains('grass')) {
                    cell.classList.add('grass');
                    span.textContent = 'üå±';
                } else if (!grassPositions.includes(index) && !cell.classList.contains('carrot')) {
                    cell.classList.add('carrot');
                    span.textContent = 'ü•ï';
                }
            });
            
            // Reiniciar rodada ap√≥s 2 segundos (sem perder o jogo)
            setTimeout(() => {
                gameActive = true;
                newRound();
            }, 2500);
        }
        
        function showCelebration() {
            const celebration = document.createElement('div');
            celebration.className = 'celebration';
            
            const messages = [
                'üéâ PARAB√âNS! üéâ<br><small>Todas as cenouras encontradas!</small>',
                'üåü EXCELENTE! üåü<br><small>Voc√™ √© um expert em cenouras!</small>',
                'üèÜ PERFEITO! üèÜ<br><small>A Lulu est√° orgulhosa!</small>',
                'üéä FANT√ÅSTICO! üéä<br><small>Pr√≥xima rodada liberada!</small>'
            ];
            
            celebration.innerHTML = messages[Math.floor(Math.random() * messages.length)];
            document.body.appendChild(celebration);
            
            setTimeout(() => {
                celebration.remove();
            }, 2500);
            
            // Efeito de fogos
            createCelebrationEffects();
        }
        
        function createCelebrationEffects() {
            const effects = ['üéÜ', 'üéá', '‚ú®', 'üåü', 'üí´', 'üéâ', 'üéä'];
            
            for (let i = 0; i < 10; i++) {
                setTimeout(() => {
                    const effect = document.createElement('div');
                    effect.style.position = 'fixed';
                    effect.style.left = Math.random() * 100 + '%';
                    effect.style.top = Math.random() * 100 + '%';
                    effect.style.fontSize = '30px';
                    effect.style.zIndex = '250';
                    effect.style.pointerEvents = 'none';
                    effect.textContent = effects[Math.floor(Math.random() * effects.length)];
                    effect.style.animation = 'sparkleEffect 2s ease-out forwards';
                    
                    document.body.appendChild(effect);
                    
                    setTimeout(() => {
                        effect.remove();
                    }, 2000);
                }, i * 200);
            }
        }
        
        function gameOver() {
            // Esta fun√ß√£o agora n√£o √© mais usada, pois o jogo n√£o termina
            // Manter para compatibilidade
        }
        
        function restartGame() {
            initGame();
        }
        
        // Event listeners
        document.querySelectorAll('.cell').forEach((cell, index) => {
            cell.addEventListener('click', () => revealCell(index));
        });
        
        // Inicializar jogo
        initGame();
        
        // Easter egg: Konami code
        let konamiCode = [];
        const konami = [38, 38, 40, 40, 37, 39, 37, 39, 66, 65]; // ‚Üë‚Üë‚Üì‚Üì‚Üê‚Üí‚Üê‚ÜíBA
        
        document.addEventListener('keydown', (e) => {
            konamiCode.push(e.keyCode);
            if (konamiCode.length > konami.length) {
                konamiCode.shift();
            }
            
            if (konamiCode.length === konami.length && 
                konamiCode.every((code, index) => code === konami[index])) {
                
                // Feedback visual do c√≥digo Konami
                showKonamiSuccess();
                
                // Modo especial: adiciona mais animais
                for (let i = 0; i < 3; i++) {
                    setTimeout(() => {
                        const newAnimal = document.createElement('div');
                        newAnimal.className = 'animal';
                        newAnimal.style.bottom = Math.random() * 15 + 25 + '%';
                        newAnimal.style.left = '-80px';
                        newAnimal.style.animationDelay = '0s';
                        newAnimal.style.fontSize = '48px';
                        newAnimal.textContent = ['üêë', 'üê¥', 'ü¶Ü'][i];
                        document.body.appendChild(newAnimal);
                        
                        setTimeout(() => {
                            newAnimal.remove();
                        }, 15000);
                    }, i * 2000 + 1000); // Delay para aparecer ap√≥s o feedback visual
                }
                konamiCode = [];
            }
        });
        
        function showKonamiSuccess() {
            // Flash na tela
            const flash = document.createElement('div');
            flash.className = 'screen-flash';
            document.body.appendChild(flash);
            
            setTimeout(() => {
                flash.remove();
            }, 500);
            
            // Mensagem de sucesso
            const message = document.createElement('div');
            message.className = 'konami-message';
            message.innerHTML = `
                üéâ C√ìDIGO KONAMI ATIVADO! üéâ<br>
                <small>Novos animais chegando √† fazenda!</small>
            `;
            document.body.appendChild(message);
            
            setTimeout(() => {
                message.remove();
            }, 3000);
            
            // Efeito de part√≠culas/estrelas
            createSparkles();
        }
        
        function createSparkles() {
            const sparkleContainer = document.createElement('div');
            sparkleContainer.className = 'konami-sparkles';
            document.body.appendChild(sparkleContainer);
            
            const sparkleEmojis = ['‚ú®', '‚≠ê', 'üåü', 'üí´', 'üéÜ'];
            
            // Criar m√∫ltiplas part√≠culas
            for (let i = 0; i < 15; i++) {
                setTimeout(() => {
                    const sparkle = document.createElement('div');
                    sparkle.className = 'sparkle';
                    sparkle.textContent = sparkleEmojis[Math.floor(Math.random() * sparkleEmojis.length)];
                    
                    // Posi√ß√£o aleat√≥ria na tela
                    sparkle.style.left = Math.random() * 100 + '%';
                    sparkle.style.top = Math.random() * 100 + '%';
                    
                    sparkleContainer.appendChild(sparkle);
                    
                    // Remover ap√≥s anima√ß√£o
                    setTimeout(() => {
                        sparkle.remove();
                    }, 2000);
                }, i * 100);
            }
            
            // Remover container ap√≥s todas as anima√ß√µes
            setTimeout(() => {
                sparkleContainer.remove();
            }, 3000);
        }
    </script>
</body>
</html>
